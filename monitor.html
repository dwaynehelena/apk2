<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>APK Build Monitor</title>
    <style>
        body {
            background: #111;
            color: #0f0;
            font-family: monospace;
            padding: 20px;
        }

        .status-card {
            border: 1px solid #333;
            padding: 20px;
            margin-bottom: 20px;
            background: #000;
        }

        h1 {
            margin-top: 0;
            color: #fff;
        }

        .log-window {
            height: 400px;
            overflow-y: scroll;
            border: 1px solid #444;
            padding: 10px;
            background: #0a0a0a;
            color: #ccc;
            white-space: pre-wrap;
            font-size: 12px;
        }

        .progress-bar {
            height: 20px;
            background: #333;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: #0f0;
            width: 0%;
            transition: width 0.5s;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            background: #333;
            color: #fff;
        }

        .status-badge.running {
            background: #0055ff;
        }

        .status-badge.success {
            background: #00aa00;
        }

        .status-badge.error {
            background: #aa0000;
        }
    </style>
</head>

<body>
    <div class="status-card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h1>Build Status: <span id="mainStatus" class="status-badge">IDLE</span></h1>
            <div id="stepName">Waiting to start...</div>
        </div>
        <div class="progress-bar">
            <div id="progress" class="progress-fill"></div>
        </div>
    </div>

    <div class="status-card">
        <h3>Live Build Logs</h3>
        <div id="logWindow" class="log-window">Logs will appear here...</div>
    </div>

    <script>
        const logWindow = document.getElementById('logWindow');
        const mainStatus = document.getElementById('mainStatus');
        const stepName = document.getElementById('stepName');
        const progress = document.getElementById('progress');

        async function update() {
            try {
                const response = await fetch('/build_status.json');
                const data = await response.json();

                mainStatus.textContent = data.status.toUpperCase();
                mainStatus.className = `status-badge ${data.status}`;
                stepName.textContent = data.current_step;
                progress.style.width = data.progress + '%';

                if (data.logs && data.logs.length > 0) {
                    logWindow.textContent = data.logs.join('\n');
                    logWindow.scrollTop = logWindow.scrollHeight;
                }
            } catch (e) {
                // Ignore parsing errors while file is being written
            }
        }

        setInterval(update, 1000);
    </script>
</body>

</html>